Phoenix.jQuery.getDocument().ready(function(){"use strict";Phoenix.Wiki=function(e){var i=null;var a={originalFields:{},editableFields:{}};var d={};var t="You're leaving?!";var s="Saving...";var n="Very busy...";var o=$(".sticky-nav");var r=function(){$(".wiki-controls").addClass("edit-view");$(".wiki-controls-extra").removeClass("hide");$(".wiki-controls-extra-ajax").removeClass("hide")};var l=function(){$(".wiki-controls").removeClass("edit-view");$(".wiki-controls-extra").addClass("hide");$(".wiki-controls-extra-ajax").removeClass("hide")};var c=function(e,i,d){if(!a[d][e]){a[d][e]={};$.each(i,function(i){a[d][e][i]=$("#"+i).contents()})}};var f=0;var h=function(e,i,a){if(a){c(e,i,a)}$.each(i,function(e,i){var a=$("#"+e);var d;var t;if(typeof i==="string"){a.contents().detach();if(a.attr("type")==="hidden"){a.val(i);return}a.html(i);t=a.html();if(t&&t.indexOf("js-editor-textarea")>0){d=v(a);if(d!==false){d.instance.richTextEditor()}}else if(t&&t.indexOf("_release_date_type")>0){f=a.find("input").val();$(".wiki-datetime").wikiDatePicker(f)}else if(t&&t.indexOf("_release_date")>0){a.find(".datepicker-input").datepicker()}else{m(a,false)}}else{d=v(a);if(d===false){a.contents().detach();a.append(i)}else{if(d.context.is(":hidden")===true){a.contents().not(d.context).detach();d.instance.richTextEditor()}else{d.instance.richTextEditor("hide");a.append(i)}}}});PhoenixDatePicker.initializeDatePickers()};var u="richTextEditor";var m=function(e,i){e.data(u,i)};var v=function(e){var i=e.data(u),a;if(i===undefined){a=e.find("textarea.js-editor-textarea");if(a.length===0){i=false}else{i={instance:a,context:e.contents()}}m(e,i)}return i};var p=function(a){var d={action:"edit",id:a||""};$.ajax({type:"GET",url:e.location.pathname,data:d,beforeSend:Phoenix.Ui.showLoadingScreen(n),complete:Phoenix.Ui.hideLoadingScreen,success:function(e){h(a,e,"originalFields");r();var d=i.find(".search-autocomplete");d.each(function(){var e=$(this);if(e.data("initialized")===true){return}e.autocomplete({showNotificationBar:true});e.data("initialized",true)});k(i);C(i)},error:function(){Phoenix.Ui.showErrorMessage("Whoops. Looks like we ran into an error.")}})};var k=function(e){e.find(".wiki-autocomplete").each(function(){var e=$(this);e.autocomplete({podLimit:null,showEmptyText:true,showNotificationBar:true,notificationText:"Searching for items",onActivate:function(){var e=this;e.dom.$resultList.find(".notificationBar").removeClass("hide")},afterShowResults:function(i,a,d){a.find(".noResults").remove();var t=$('<li><div class="noResults add-new-object">Click here to add a new item</div>');a.append(t);t.click(function(){var i=d.getValue();var a="-"+e.parents("span").first().attr("data-orig-type-id")+"-"+i;var t=d.addResultPodFromTemplate({overrideGuid:a,name:i,extraPodClass:"fake-item"});var s=$(".wiki-controls");var n=$(".wiki-controls .added-items");var o=$(".wiki-controls .added-items-container");var r=$("<span>"+i+"</span>");o.append(r);n.removeClass("hide");if(!s.find(".controls-big").hasClass("hide")){var l=n.outerHeight()+parseInt(s.css("padding"),10);s.css("height",l+s.outerHeight())}t.on("click","i:has(svg.symbol-remove)",function(){r.remove();if(o.find(":not(.hide)").length===0){if(!s.find(".controls-big").hasClass("hide")){var e=n.outerHeight()+parseInt(s.css("padding"),10);s.css("height",s.outerHeight()-e)}n.addClass("hide")}});d.deactivate(false)});a.find(".notificationBar").addClass("hide")},resultPodTemplate:function(e){var i=e.overrideGuid?e.overrideGuid:e.contentTypeId+"-"+e.id;var a=this.options.podInputName+(/\[\]$/.test(this.options.podInputName)?"":"["+i+"]");var d=$("<span></span>").addClass(this.options.podClass);if(e.extraPodClass){d.addClass(e.extraPodClass)}var t=$("<span></span>").text(e.name||e.title);var s='<i><svg class="symbol symbol-remove"><use xlink:href="#symbol-remove"></use></svg></i>';var n=$('<input type="hidden">').attr("name",a).attr("value",i);d.append(t).append(s).append(n);return d}})})};var C=function(e){var i=e.find(".wiki-table-autocomplete");i.wikiTableAutocomplete()};var g=function(e){if(a.editableFields[e]){h(e,a.editableFields[e]);r()}else{p(e)}w()};var w=function(){$("body").addClass("wiki-editing")};var x=function(){$("body").removeClass("wiki-editing")};var j=function(i){i=i||e.event;i.cancelBubble=true;if(i.stopPropagation){i.stopPropagation();i.preventDefault()}i.returnValue=t;return t};var b=function(){e.onbeforeunload=null};var y=function(a){a.stopPropagation();a.preventDefault();o.attr("data-sticky-disabled","true");var t=null,s=$(this);t=s.off("click").addClass("disabled").addClass("hide").data("id");i=$(".wikiGroup");i.submit(function(e){return false});d[t]=s;e.onbeforeunload=j;g(t)};var P=function(){l();$.each(d,function(e){$(this).removeClass("disabled").removeClass("hide").on("click",y);h(e,a.originalFields[e],"editableFields");delete d[e]});o.attr("data-sticky-disabled","");b();x()};var E=function(){var a=encodeURIComponent($("#wikiCommitMessage").val()),d=i.find("textarea.js-editor-textarea"),t,n;if(d.length>0){t=d.filter(function(){var e=$(this);return e.richTextEditor("isRequired")&&e.richTextEditor("isEmpty")});if(t.length>0){t.richTextEditor("warnRequiredEmpty");return}else{d.richTextEditor("save")}}n=i.serializeArray();n.push({name:"action",value:"save"});if(a){n.push({name:"comment",value:a})}for(var r=0,l=n.length;r<l;r++){if(n[r]["name"].match(/\[date\]$/)&&!n[r]["value"]){n[r]["value"]="01/01/1900"}}o.attr("data-sticky-disabled","");$(".wiki-controls").find("input").attr("disabled","disabled");$.ajax({type:"POST",url:e.location.pathname,data:n,beforeSend:Phoenix.Ui.showLoadingScreen(s),success:function(e){console.log(e);if(e.success===0){$(".wiki-controls").find("input").attr("disabled","");alert(e.errorMessage);return}b();$(".wiki-controls").remove();if(e.moderated.moderated>=0){Phoenix.Ui.showSuccessMessage("Edits sent successfully.")}var i=$("#js-wiki-conf");i.find(".limit").text(e.moderated.limitPoints);i.find(".points").text(e.moderated.points);if(n.url){i.find(".js-redirect-button").attr("href",n.url).text("Click here to continue")}if(e.moderated.moderated===-3){i.find(".js-moderated").addClass("hide");i.find(".js-wiki-ban").addClass("hide");i.find(".js-wiki-disabled").removeClass("hide");i.find(".js-no-changes").addClass("hide");i.find(".js-some-moderated").addClass("hide");i.find(".js-no-moderated").addClass("hide")}else if(e.moderated.moderated===-2){i.find(".js-moderated").addClass("hide");i.find(".js-wiki-ban").removeClass("hide");i.find(".js-wiki-disabled").addClass("hide");i.find(".js-no-changes").addClass("hide");i.find(".js-some-moderated").addClass("hide");i.find(".js-no-moderated").addClass("hide")}else if(e.moderated.moderated===-1){i.find(".js-moderated").addClass("hide");i.find(".js-wiki-ban").addClass("hide");i.find(".js-wiki-disabled").addClass("hide");i.find(".js-no-changes").removeClass("hide");i.find(".js-some-moderated").addClass("hide");i.find(".js-no-moderated").addClass("hide")}else if(e.moderated.moderated===1){i.find(".js-moderated").removeClass("hide");i.find(".js-wiki-ban").addClass("hide");i.find(".js-wiki-disabled").addClass("hide");i.find(".js-no-changes").addClass("hide");i.find(".js-some-moderated").addClass("hide");i.find(".js-no-moderated").addClass("hide")}else if(e.moderated.moderated===0&&e.moderated.limitPoints!==-1){i.find(".js-moderated").addClass("hide");i.find(".js-wiki-ban").addClass("hide");i.find(".js-wiki-disabled").addClass("hide");i.find(".js-no-changes").addClass("hide");i.find(".js-some-moderated").removeClass("hide");i.find(".js-no-moderated").addClass("hide")}else{i.find(".js-moderated").addClass("hide");i.find(".js-wiki-ban").addClass("hide");i.find(".js-wiki-disabled").addClass("hide");i.find(".js-no-changes").addClass("hide");i.find(".js-some-moderated").addClass("hide");i.find(".js-no-moderated").removeClass("hide")}i.modal("show");x()},complete:Phoenix.Ui.hideLoadingScreen,error:function(){Phoenix.Ui.showErrorMessage("Whoops, looks like we ran into an error.")}})};var T=function(){e.alert("To do: support deleting.")};var S=function(e){e.find(".controls-small").addClass("hide");e.find(".controls-big").removeClass("hide").css("display","block");e.css("height",e.outerHeight());e.draggable()};var U=function(e){e.find(".controls-small").addClass("hide");e.find(".controls-big").removeClass("hide");e.draggable("destroy");e.css("height","");e.css("top","");e.css("left","");e.one("mouseenter",function(){S(e)})};var R=function(){$(document).on("click",".js-wikiEdit",y);$(document).on("click",".js-wikiDelete",T);var e=$(".wiki-controls");e.find("#wikiEditSave").on("click",function(){U(e);E()}).end().find("#wikiEditCancel").on("click",function(){U(e);P()});e.one("mouseenter",function(){S(e)});$(document).on("click",".wiki-controls-extra-ajax",function(e){e.preventDefault();e.stopPropagation();AjaxApiRequest.makeGetApiRequest($(this).attr("href"),function(e){if(e.success===0){Phoenix.Ui.showErrorMessage(e.error);return}if(e.message){Phoenix.Ui.showSuccessMessage(e.message)}else if(e.error){Phoenix.Ui.showSuccessMessage(e.error)}})})};return{init:R}}(window);Phoenix.Wiki.init()});
$(document).ready(function(){$(document).on("change",".js-wiki-entity-widget",function(t){t.preventDefault();var e=$(this);var i=e.val();if(!i){return}var n=e.attr("id");var a=$(".js-wiki-"+n);var r=a.clone();var s=r.find('input[type="hidden"]');var d=e.val();var v=s.data("name");var l=$('.js-wiki-entity-item input[name="'+v+'"][value="'+d+'"]');if(l.length>0){return}s.val(d);s.attr("name",v);r.attr("class","");r.addClass("js-wiki-entity-item");r.addClass("wiki-list-item");var m=r.find("span.js-wiki-entity-name");var c=m.children();m.text(e.find(":selected").text());m.append(c);e.after(r);e.find("option").removeAttr("selected")});$(document).on("click",".js-wiki-entity-remove, .js-wiki-entity-item svg",function(t){$(this).parents(".js-wiki-entity-item").remove()})});
(function(e){"use strict";var t={};e.fn.wikiTableAutocomplete=function(){return this.each(function(){var i=e(this);if(i.data("intialized")==="true"){return}i.data("intialized","true");i.autocomplete({podLimit:null,showEmptyText:true,showNotificationBar:true,notificationText:"Searching for items",onActivate:function(){var e=this;e.dom.$resultList.find(".notificationBar").removeClass("hide")},afterShowResults:function(t,r,s){r.find(".noResults").remove();var n=e('<li><div class="noResults add-new-object">Click here to add a new item</div>');r.append(n);n.click(function(){var t=s.getValue();var r="-"+i.parents("ul").attr("data-orig-type-id")+"-"+t;var n=s.options.podInputName+(/\[\]$/.test(s.options.podInputName)?"":"["+r+"]");a(i,n,t,{image:e.fn.autocomplete.defaults.placeholderGraphic,name:t},true);s.deactivate(false);s.setValue("")});r.find(".notificationBar").addClass("hide")},onItemSelect:function(e,t){var r=e.contentTypeId+"-"+e.id;var s=t.options.podInputName+(/\[\]$/.test(t.options.podInputName)?"":"["+r+"]");var n=i.parents("ul");var d=n.find('input[value="'+r+'"]');var l=false;d.each(function(e,t){if(d.attr("name").indexOf("description")<0){l=true;return false}});if(l){alert("Object already in table");return}a(i,s,r,e);t.setValue("")}});var r=i.parents("ul").first();if(r.data("delete-intiailized")===true){return}r.data("delete-intiailized",true);r.on("click",".js-delete-row",function(a){a.preventDefault();a.stopPropagation();var i=e(this).parents("li").first();var r=e(".wiki-controls");var s=e(".wiki-controls .added-items");var n=e(".wiki-controls .added-items-container");if(i.hasClass("deleted-row")){i.removeClass("deleted-row");i.find("input").removeAttr("disabled");i.find("textarea").removeAttr("disabled");i.find("select").removeAttr("disabled");if(i.hasClass("created-row")){t[i].removeClass("hide");s.removeClass("hide");if(!r.find(".controls-big").hasClass("hide")){var d=s.outerHeight()+parseInt(r.css("padding"),10);r.css("height",r.outerHeight()+d)}}e(this).removeClass("icon-plus-sign").addClass("icon-minus-sign")}else{i.addClass("deleted-row");i.find("input").attr("disabled","disabled");i.find("textarea").attr("disabled","disabled");i.find("select").attr("disabled","disabled");if(i.hasClass("created-row")){t[i].addClass("hide");if(n.find(":not(.hide)").length===0){if(!r.find(".controls-big").hasClass("hide")){var d=s.outerHeight()+parseInt(r.css("padding"),10);r.css("height",r.outerHeight()-d)}s.addClass("hide")}}e(this).removeClass("icon-minus-sign").addClass("icon-plus-sign")}})})};var a=function(a,i,r,s,n){var d=a.parents("ul");var l=d.find(".js-wiki-autocomplete-template-row");var o=l.clone();o.removeClass("hide").removeClass("js-wiki-autocomplete-template-row");var c=/{\s*([\d\w+]*)\s*}/g;var p=o.html();var u=true;while(u!==null){u=c.exec(p);if(u!==null){var f=u[0];var v=u[1];if(v==="image"&&s[v]===undefined){s[v]=e.fn.autocomplete.defaults.placeholderGraphic}p=p.replace(f,s[v])}}p=p.replace("data-new-attr-","");o.html(p);var h=o.find('input[data-type!="choice"]');h.attr("value",r).attr("name",i);var m=o.find("textarea");if(m.length<=0){var g=e('<input type="hidden"></input>').attr("name",i+"[description]").attr("value","");h.after(g)}else{m.attr("name",i+"[description]")}var w=o.find('input[data-type="choice"]');if(w.length>0){var C=w.data("name");var b=w.attr("data-values").split(",");var k=null;if(w.attr("data-widget-type")==="select"){var y=w.parents("li").find(".relation-note");k=e('<select name="'+i+"["+C+"]"+'"></select>');y.prepend(k);var I=null;e.each(b,function(){if(this===""){return true}var t=this.split("::");var a=e('<option value="'+t[1]+'"> '+t[0]+"</option>");I=a;k.append(a)});I.attr("selected","selected")}else{k=e("<dl></dl>");w.parents("li").append(k);e.each(b,function(){if(this===""){return true}var t=this.split("::");var a=e('<input type="checkbox" value="'+t[1]+'"> '+t[0]+"</input>");a.attr("name",i+"["+C+"][]");var r=e("<dd></dd>").append(a);k.append(r)})}w.remove()}if(n){o.addClass("created-row");var x=e("<span>"+r+"</span>");var j=e(".wiki-controls");var H=e(".wiki-controls .added-items");var A=e(".wiki-controls .added-items-container");A.append(x);if(H.hasClass("hide")){H.removeClass("hide");if(!j.find(".controls-big").hasClass("hide")){var N=H.outerHeight()+parseInt(j.css("padding"),10);j.css("height",N+j.outerHeight())}}t[o]=x}else{o.addClass("added-row")}a.parents("li").first().after(o)}})(jQuery);
$(document).ready(function(){"use strict";var t=false;$(".js-add-to-user-list").click(function(i){$("#modal_add_to_list").modal("show");if(!t){AjaxApiRequest.makeGetApiRequest("/api/list/paginated-lists/",function(t){if(t.success){$("#modal_add_to_list .loading").remove();$("#modal_add_to_list .js-simple-paginator-container").html(t.html)}else{Phoenix.Ui.showErrorMessage("Could not load lists");$("#modal_add_to_list").modal("hide")}},function(){Phoenix.Ui.showErrorMessage("Could not load lists");$("#modal_add_to_list").modal("hide")});t=true}i.preventDefault()});$("#modal_add_to_list").on("click","tr.js-add-list",function(t){var i=$("#modal_add_to_list table").data("object-guid");var o=$(t.target);if(!o.is("tr")){o=o.parents("tr")}var a=o.attr("data-ref-id");AjaxApiRequest.makeGetApiRequest("/api/list/"+a+"/add-item/"+i+"/",function(t){if(t.success){Phoenix.Ui.showSuccessMessage("Successfully added item to list.");$("#modal_add_to_list").modal("hide")}else{Phoenix.Ui.showErrorMessage("Error while adding object to list.");$("#modal_add_to_list").modal("hide")}},function(){Phoenix.Ui.showErrorMessage("Error while adding object to list.");$("#modal_add_to_list").modal("hide")})})});
$(document).ready(function(){"use strict";var t=function(){$('.js-alias-widget[data-initialized="false"]').each(function(t,a){var n=$(this);var e=n.find('input[type="hidden"]').first();var r=e.attr("value");var s=null;if($.trim(r)===""){s=[]}else{s=r.split("\n")}for(var l=0;l<s.length;l=l+1){var v=s[l];i(n,v)}n.removeAttr("data-initialized")})};var i=function(t,i){var a=t.find(".template");var n=a.clone();n.find(".text").text(i);t.append(n.children())};t();$(document).ajaxStop(function(i){t()});function a(t){var a=t.parents(".js-alias-widget").first();var n=a.find('input[type="hidden"]').first();var e=n.attr("value");var r=null;if($.trim(e)===""){r=[]}else{r=e.split("\n")}var s=t.val();if(s.indexOf("\n")>=0){alert("Alias can not contain newlines character.");return}var l=$.inArray(s,r);if($.trim(s)===""||l!==-1){t.val("");return}r.push(s);var v=r.join("\n");n.attr("value",v);i(a,s);t.val("")}$(document).on("click",".js-alias-widget-button",function(t){var i=$(this).siblings(".js-alias-widget-input");t.preventDefault();a(i)});$(document).on("keydown",".js-alias-widget-input",function(t){var i=$(this);if(t.which===13){t.preventDefault();a(i)}});$(document).on("click",".js-alias-widget .js-alias-widget-remove, .js-alias-widget svg",function(t){var i=$(this);var a=i.parents(".js-alias-widget").first();var n=a.find('input[type="hidden"]').first();var e=i.parents(".wiki-list-item").first();var r=e.find(".text").text().trim();var s=n.attr("value").trim();if(s==""){n.val("")}else{var l=s.split("\n");var v=l.filter(function(t){return t.trim()!=r});n.val(v.join("\n"))}e.remove()})});
$(document).ready(function(){"use strict";$(".js-delete-wiki-object").on("click",function(e){e.preventDefault();var t=$(this).attr("href");if(!confirm("WOAH THERE, ARE YOU SURE YOU WANT TO DO THIS? This will delete this object from the DB completelty! Tread carefully")){return}$.post(t,function(e){if(e.success===0){alert(e.message);return}alert("Deletion done, hope you're happy now!")})});$(".js-delete-wiki-child").on("click",function(e){e.preventDefault();var t=$(this).attr("href");var i=$(this).data("type-id");var r=$(this).data("id");if(!confirm("WOAH THERE, ARE YOU SURE YOU WANT TO DO THIS? This will delete this object from the DB completelty! Tread carefully")){return}$.post(t,{id:r,typeId:i},function(e){if(e.success===0){alert(e.message);return}alert("Deletion done, hope you're happy now!");location.reload()})})});